<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Black Market Brief</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
   :root{
  --blue:#1b4cff;
  --red:#d61f2c;
  --muted:#333;
  --thin:#e9e9e9;
}

/* =========================
   Base / Mobile-first
   ========================= */

body {
  background:#fff;
  color:#000;
  font-family: Arial, Helvetica, sans-serif;
  margin:0;
  padding:14px 12px;
  max-width:900px;
  margin-left:auto;
  margin-right:auto;
  -webkit-text-size-adjust:100%;
}

/* =========================
   Masthead
   ========================= */

h1 {
  text-align:center;
  font-size:42px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:3px;
  font-style:italic;
  transform:skew(-8deg);
  margin:8px 0 8px;
  text-shadow:
    2px 2px 0 var(--blue),
    4px 4px 0 var(--red),
    6px 6px 0 rgba(0,0,0,0.18);
}

.subhead {
  text-align:center;
  font-size:13px;
  font-weight:800;
  margin:0 0 12px;
  letter-spacing:0.8px;
  text-transform:uppercase;
  color:#111;
}

/* =========================
   Meta row
   ========================= */

.meta {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  font-size:12px;
  color:var(--muted);
  margin:8px 0 14px;
  flex-wrap:wrap;
}

.pill {
  border:1px solid var(--thin);
  padding:6px 10px;
  border-radius:999px;
  font-weight:800;
  letter-spacing:0.4px;
  text-transform:uppercase;
  background:#fafafa;
}

/* =========================
   List reset
   ========================= */

ul {
  list-style:none;
  padding:0;
  margin:0;
}

/* =========================
   State headers
   ========================= */

.state-header{
  margin:20px 0 6px;
  font-size:13px;
  font-weight:900;
  letter-spacing:1px;
  text-transform:uppercase;
  color:#000;
}

/* =========================
   Headline entries (indented)
   ========================= */

.headline-item{
  margin:0 0 14px;
  padding-left:14px;
  font-size:17px;
  line-height:1.25;
  position:relative;
}

/* subtle visual cue (not a divider) */
.headline-item::before{
  content:"–";
  position:absolute;
  left:0;
  top:0;
  color:#999;
  font-weight:900;
}

a{
  color:#000;
  text-decoration:underline;
  font-weight:900;
  word-break:break-word;
}

a:hover{
  color:#0033cc;
}

/* =========================
   Footer
   ========================= */

.footer{
  text-align:center;
  margin-top:26px;
  font-size:13px;
  color:var(--muted);
}

.footer a{
  color:#0040ff;
  text-decoration:underline;
  font-weight:800;
}

.footer a:hover{
  color:#cc0000;
}

/* =========================
   Tablet / Desktop
   ========================= */

@media (min-width:700px){
  body{
    padding:20px;
  }

  h1{
    font-size:54px;
    letter-spacing:4px;
    margin:10px 0 10px;
  }

  .subhead{
    font-size:16px;
    margin-bottom:18px;
  }

  .meta{
    font-size:13px;
    margin-bottom:16px;
    flex-wrap:nowrap;
  }

  .state-header{
    margin-top:22px;
    font-size:14px;
  }

  .headline-item{
    padding-left:18px;
    font-size:18px;
    line-height:1.3;
    margin-bottom:12px;
  }
}

  </style>
</head>

<body>
  <h1>BLACK MARKET BRIEF</h1>
  <div class="subhead">Disrupting the Illegal Chinese Vape Supply Chain • Protecting Communities</div>

  <div class="meta">
    <div class="pill">Live Desk</div>
    <div id="last-updated">Updated: —</div>
  </div>

  <ul id="headline-list">
    <li>Loading headlines…</li>
  </ul>

  <script>
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTz6qSLgIjDAsDkravmNu3PKrXbDHyGfKHAEY5r0Tyg0ot0co7rCX_S0Y5XtDgOQ34q0DBH1o1tRbbE/pub?output=tsv";

  function splitTSVLine(line) {
    // Basic TSV split + trim + remove wrapping quotes
    return line.split("\t").map(v => (v || "").trim().replace(/^"|"$/g, ""));
  }

  function parseTSV(text) {
    const lines = text.trim().split(/\r?\n/);
    if (lines.length <= 1) return [];

    const headers = splitTSVLine(lines[0]).map(h => h.toLowerCase());

    // Find columns by header name (robust even if you rearrange sheet columns)
    const idxTitle = headers.findIndex(h => h === "article title" || h === "title");
    const idxLink  = headers.findIndex(h => h === "link" || h === "url");
    const idxState = headers.findIndex(h => h === "state");

    if (idxTitle === -1 || idxLink === -1) {
      console.error("Missing required columns. Need 'Article Title' and 'Link'. Headers:", headers);
      return [];
    }

    return lines.slice(1).map(line => {
      const cols = splitTSVLine(line);
      const title = cols[idxTitle] || "";
      const url   = cols[idxLink]  || "";
      const state = (idxState !== -1 ? (cols[idxState] || "") : "");

      return { title, url, state };
    }).filter(r => r.title && r.url);
  }

  function normalizeState(state) {
    // Keep it simple; treat blanks as "Unknown"
    const s = (state || "").trim();
    return s ? s : "Unknown";
  }

  fetch(SHEET_URL)
    .then(res => res.text())
    .then(text => {
      let entries = parseTSV(text).slice(0, 500); // raise cap if you want more

      // Sort by State A-Z, then Title A-Z
      entries.sort((a, b) => {
  const sa = normalizeState(a.state);
  const sb = normalizeState(b.state);

  // Force "National" to the top
  if (sa === "National" && sb !== "National") return -1;
  if (sb === "National" && sa !== "National") return 1;

  // Alphabetical by state
  const saLower = sa.toLowerCase();
  const sbLower = sb.toLowerCase();
  if (saLower < sbLower) return -1;
  if (saLower > sbLower) return 1;

  // Alphabetical by title within state
  const ta = a.title.toLowerCase();
  const tb = b.title.toLowerCase();
  if (ta < tb) return -1;
  if (ta > tb) return 1;
  return 0;
});

      });

      const listEl = document.getElementById("headline-list");
      listEl.innerHTML = "";

      // Grouped rendering by state
      let currentState = null;

      entries.forEach(item => {
        const state = normalizeState(item.state);

        if (state !== currentState) {
          currentState = state;

          const headerLi = document.createElement("li");
          headerLi.className = "state-header";
          headerLi.textContent = currentState;
          listEl.appendChild(headerLi);
        }

        const li = document.createElement("li");
        li.className = "headline-item";

        const a = document.createElement("a");
        a.href = item.url;
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.textContent = item.title;

        li.appendChild(a);
        listEl.appendChild(li);
      });

      document.getElementById("last-updated").textContent =
        "Updated: " + new Date().toLocaleString();
    })
    .catch(err => {
      console.error("Error loading sheet:", err);
      document.getElementById("headline-list").innerHTML =
        "<li>Unable to load headlines.</li>";
    });
</script>

  <div class="footer">
    Built to track contraband enforcement actions.
  </div>
</body>
</html>
